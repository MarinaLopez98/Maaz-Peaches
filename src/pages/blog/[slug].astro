---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Layout from '@layouts/Default.astro';
import { Card } from '@eliancodes/brutal-ui';
import BuyMeCoffee from '@components/generic/BuyMeCoffee.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map((blogpost) => ({
    params: { slug: blogpost.slug },
    props: { blogpost },
  }));
}

interface Props {
  blogpost: CollectionEntry<'blog'>;
}

const { blogpost } = Astro.props;
const { Content } = await blogpost.render();
const { title, description, author } = blogpost.data;
const pubDate = new Date(blogpost.data.pubDate);
---

<Layout title={title} description={description}>
  <main class='bg-#e4a6ca p-6'>
    <article class='max-w-4xl mx-auto'>
      <Card color='#ffffff'>
        <header class='mb-8'>
          <h1 class='text-3xl md:text-5xl lg:text-6xl mb-4 dm-serif'>{title}</h1>
          <div class='flex gap-4 text-sm poppins text-gray-600 mb-4'>
            <time datetime={pubDate.toISOString()}>
              {pubDate.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
            <span>•</span>
            <span>{author}</span>
          </div>
          <div class='bg-gray-50 p-4 rounded-lg border-2 border-black mb-6'>
            <p class='poppins text-lg italic text-gray-700'>{description}</p>
          </div>
        </header>
        <div class='prose prose-lg max-w-none poppins'>
          <Content />
        </div>
        
        <!-- Comentarios simples con colores mejorados -->
        <section style="margin: 3rem 0 2rem; padding: 2rem; background: linear-gradient(135deg, #fff5f9 0%, #fef9fb 100%); border: 3px solid #e8b4d4; border-radius: 1.5rem; box-shadow: 0 4px 12px rgba(232, 180, 212, 0.15);">
          <div style="text-align: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 2px dashed #f5d4e6;">
            <h3 style="margin: 0 0 0.5rem 0; font-size: 1.75rem; font-weight: 700; color: #d87ba7; font-family: 'DM Serif Display', serif;">Comments</h3>
            <p style="margin: 0; font-size: 0.95rem; color: #9f7091; font-family: 'Poppins', sans-serif; font-style: italic; line-height: 1.6;">Leave a comment below. Your thoughts are welcome.</p>
          </div>

          <div style="margin-bottom: 2rem;">
            <form id="commentForm" style="display: flex; flex-direction: column; gap: 1.25rem;">
              <input type="hidden" name="access_key" value="ac372efb-3a75-42da-9aa0-a90846659aa4">
              <input type="hidden" name="subject" value="New comment on blog">
              <input type="hidden" name="from_name" value="Blog Maaz-Peaches">
              <input type="hidden" name="redirect" value="false">

              <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <label style="font-size: 0.9rem; font-weight: 600; color: #9f7091; font-family: 'Poppins', sans-serif;" for="name">Name</label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  placeholder="Your name (or leave empty for anonymous)"
                  style="padding: 0.75rem 1rem; border: 2px solid #f5d4e6; border-radius: 0.75rem; font-size: 0.95rem; font-family: 'Poppins', sans-serif; background: #ffffff; color: #9f7091; transition: all 0.3s ease;"
                />
              </div>

}
        
        <BuyMeCoffee username="rollingpeaches" />
        
        <div class='flex justify-center mt-6'>
          <img 
            src='https://raw.githubusercontent.com/MarinaLopez98/Maaz-Peaches/master/src/assets/Peach.jpg' 
            alt='Ilustración Peach' 
            class='rounded-lg border-2 border-black shadow-lg'
            style='max-width: 300px; width: 100%;'
            loading='lazy'
          />
        </div>
        
      </Card>
    </article>
  </main>
</Layout>

      }

      }
    }

      };

      // Simple HTML without complex JavaScript
      div.innerHTML = '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px solid #f5d4e6;"><span style="font-weight: 600; color: #d87ba7; font-family: \'Poppins\', sans-serif; font-size: 0.95rem;">' + escapeHtml(comentario.nombre) + '</span><span style="font-size: 0.8rem; color: #b89aa8; font-family: \'Poppins\', sans-serif;">' + fechaTexto + '</span></div><p style="color: #d87ba7; font-family: \'Poppins\', sans-serif; font-size: 0.95rem; line-height: 1.6; margin: 0 0 0.75rem 0;">' + escapeHtml(comentario.texto) + '</p><button onclick="showReplyForm()" style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.35rem 0.75rem; background: linear-gradient(135deg, #fef9fb 0%, #fff5f9 100%); color: #d87ba7; border: 1.5px solid #f5d4e6; border-radius: 0.5rem; font-size: 0.85rem; font-weight: 500; font-family: \'Poppins\', sans-serif; cursor: pointer; transition: all 0.3s ease;"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 10 4 15 9 20"></polyline><path d="M20 4v7a4 4 0 0 1-4 4H4"></path></svg>Reply</button><div id="reply-form" style="margin-top: 0.75rem; display: none; padding: 1rem; background: linear-gradient(135deg, #fff5f9 0%, #fef9fb 100%); border: 2px solid #e8b4d4; border-radius: 0.5rem;"><p style="color: #d87ba7; font-family: 'Poppins', sans-serif; font-size: 0.9rem; line-height: 1.5; margin: 0; font-style: italic;">Yes! This is a reply.</p></div>';

      div.style.cssText = 'padding: 1.25rem; margin-bottom: 1rem; background: #ffffff; border: 2px solid #f5d4e6; border-radius: 1rem; transition: all 0.3s ease;';

           }
    }

    }

function escapeHtml(text) {
  return text
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

      };
    }

  };

    }
  };
</script>
