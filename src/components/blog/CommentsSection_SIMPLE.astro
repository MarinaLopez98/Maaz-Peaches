---
// Componente de comentarios SIMPLIFICADO
---

<section class="comments-section">
  <div class="comments-header">
    <h3 class="comments-title">Comentarios</h3>
    <p class="comments-subtitle">Si no te sientes escuchado, aqu√≠ tienes el espacio perfecto. No te escucharemos, pero ten por seguro que te leer√©.</p>
  </div>

  <div class="comment-form-container">
    <form class="comment-form" id="commentForm">
      <input type="hidden" name="access_key" value="ac372efb-3a75-42da-9aa0-a90846659aa4">
      <input type="hidden" name="subject" value="üí¨ Nuevo comentario en el blog">
      <input type="hidden" name="from_name" value="Blog Maaz-Peaches">
      <input type="hidden" id="pageUrlInput">
      
      <div class="form-group">
        <label for="name">Nombre</label>
        <input 
          type="text" 
          id="name" 
          name="name" 
          placeholder="Tu nombre (o d√©jalo vac√≠o para comentar an√≥nimamente)" 
        />
      </div>
      
      <div class="form-group">
        <label for="comment">Comentario</label>
        <textarea 
          id="comment" 
          name="comment" 
          rows="4" 
          placeholder="Escribe tu comentario aqu√≠..." 
          required
        ></textarea>
      </div>
      
      <button type="submit" class="submit-button">
        <span class="button-text">Enviar comentario</span>
        <svg class="button-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </form>
  </div>

  <div class="comments-list" id="commentsList"></div>
</section>

<style>
  .comments-section {
    margin: 3rem 0 2rem;
    padding: 2rem;
    background: linear-gradient(135deg, #fff5f9 0%, #fef9fb 100%);
    border: 3px solid #e8b4d4;
    border-radius: 1.5rem;
    box-shadow: 0 4px 12px rgba(232, 180, 212, 0.15);
  }

  .comments-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px dashed #f5d4e6;
  }

  .comments-title {
    margin: 0 0 0.5rem 0;
    font-size: 1.75rem;
    font-weight: 700;
    color: #d87ba7;
    font-family: 'DM Serif Display', serif;
  }

  .comments-subtitle {
    margin: 0;
    font-size: 0.95rem;
    color: #9f7091;
    font-family: 'Poppins', sans-serif;
    font-style: italic;
    line-height: 1.6;
    max-width: 800px;
    margin: 0 auto;
  }

  .comment-form-container {
    margin-bottom: 2rem;
  }

  .comment-form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .form-group label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #9f7091;
    font-family: 'Poppins', sans-serif;
  }

  .form-group input,
  .form-group textarea {
    padding: 0.75rem 1rem;
    border: 2px solid #f5d4e6;
    border-radius: 0.75rem;
    font-size: 0.95rem;
    font-family: 'Poppins', sans-serif;
    background: #ffffff;
    color: #4a4a4a;
    transition: all 0.3s ease;
  }

  .form-group input:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #e8b4d4;
    box-shadow: 0 0 0 3px rgba(232, 180, 212, 0.15);
  }

  .form-group textarea {
    resize: vertical;
    min-height: 100px;
  }

  .submit-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.875rem 1.75rem;
    background: linear-gradient(135deg, #e8b4d4 0%, #f5d4e6 100%);
    color: #6b4a5a;
    border: 2px solid #d87ba7;
    border-radius: 0.875rem;
    font-size: 1rem;
    font-weight: 600;
    font-family: 'Poppins', sans-serif;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(232, 180, 212, 0.25);
    align-self: flex-start;
  }

  .submit-button:hover {
    background: linear-gradient(135deg, #d87ba7 0%, #e8b4d4 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(232, 180, 212, 0.35);
  }

  .comments-list {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 2px dashed #f5d4e6;
  }

  .comment-item {
    padding: 1.25rem;
    margin-bottom: 1rem;
    background: #ffffff;
    border: 2px solid #f5d4e6;
    border-radius: 1rem;
    transition: all 0.3s ease;
  }

  .comment-item:hover {
    border-color: #e8b4d4;
    box-shadow: 0 2px 8px rgba(232, 180, 212, 0.15);
  }

  .comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid #f5d4e6;
  }

  .comment-author {
    font-weight: 600;
    color: #d87ba7;
    font-family: 'Poppins', sans-serif;
    font-size: 0.95rem;
  }

  .comment-date {
    font-size: 0.8rem;
    color: #b89aa8;
    font-family: 'Poppins', sans-serif;
  }

  .comment-text {
    color: #4a4a4a;
    font-family: 'Poppins', sans-serif;
    font-size: 0.95rem;
    line-height: 1.6;
    margin: 0;
  }

  @media (max-width: 640px) {
    .comments-section {
      padding: 1.5rem;
    }
    .submit-button {
      width: 100%;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ Script cargado');
    
    const form = document.getElementById('commentForm');
    const lista = document.getElementById('commentsList');
    
    if (!form || !lista) {
      console.error('‚ùå No se encontraron elementos');
      return;
    }
    
    console.log('‚úÖ Elementos encontrados');
    
    // Cargar comentarios existentes
    cargarComentarios();
    
    // Manejar env√≠o del formulario
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      console.log('üìù Enviando comentario');
      
      const nombre = document.getElementById('name').value.trim() || 'An√≥nimo';
      const texto = document.getElementById('comment').value.trim();
      
      if (!texto) {
        alert('Escribe un comentario');
        return;
      }
      
      // Guardar en localStorage
      const slug = window.location.pathname;
      let comentarios = JSON.parse(localStorage.getItem('comentarios_' + slug) || '[]');
      
      const nuevoComentario = {
        nombre: nombre,
        texto: texto,
        fecha: new Date().toISOString()
      };
      
      comentarios.push(nuevoComentario);
      localStorage.setItem('comentarios_' + slug, JSON.stringify(comentarios));
      
      // Mostrar comentario
      mostrarComentario(nuevoComentario);
      
      // Limpiar formulario
      form.reset();
      
      // Enviar email (opcional, en segundo plano)
      enviarEmail(nombre, texto);
      
      console.log('‚úÖ Comentario guardado y mostrado');
    });
    
    function cargarComentarios() {
      const slug = window.location.pathname;
      const comentarios = JSON.parse(localStorage.getItem('comentarios_' + slug) || '[]');
      comentarios.forEach(mostrarComentario);
    }
    
    function mostrarComentario(comentario) {
      const div = document.createElement('div');
      div.className = 'comment-item';
      
      const fecha = new Date(comentario.fecha);
      const fechaTexto = fecha.toLocaleDateString('es-ES', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      div.innerHTML = `
        <div class="comment-header">
          <span class="comment-author">${escapar(comentario.nombre)}</span>
          <span class="comment-date">${fechaTexto}</span>
        </div>
        <p class="comment-text">${escapar(comentario.texto)}</p>
      `;
      
      lista.appendChild(div);
    }
    
    function escapar(texto) {
      const div = document.createElement('div');
      div.textContent = texto;
      return div.innerHTML;
    }
    
    function enviarEmail(nombre, texto) {
      const datos = new FormData();
      datos.append('access_key', 'ac372efb-3a75-42da-9aa0-a90846659aa4');
      datos.append('subject', 'üí¨ Nuevo comentario en el blog');
      datos.append('from_name', 'Blog Maaz-Peaches');
      datos.append('name', nombre);
      datos.append('comment', texto);
      datos.append('page_url', window.location.href);
      
      fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        body: datos
      }).catch(err => console.warn('Email no enviado:', err));
    }
  });
</script>
